services:
  nginx:
    image: nginx:latest
    container_name: nginx-proxy
    ports:
      - "80:80" # HTTP ê¸°ë³¸ í¬íŠ¸
      - "443:443" # HTTPS ê¸°ë³¸ í¬íŠ¸
    volumes:
      - ./nginx/nginx.conf:/etc/nginx/nginx.conf # nginx ì„¤ì • íŒŒì¼ì„ ì§€ì •í•˜ëŠ” ë¶€ë¶„ì…ë‹ˆë‹¤. ê¸°ë³¸ ìœ„ì¹˜ë¥¼ ë³€ê²½í•˜ì§€ ì•ŠëŠ” ê²ƒì„ ì¶”ì²œí•©ë‹ˆë‹¤.
      - ./nginx/certs:/etc/ssl/certs # SSL ì¸ì¦ì„œ í´ë” ìœ„ì¹˜
      - ./nginx/logs:/var/log/nginx # Nginx ë¡œê·¸ í´ë” ìœ„ì¹˜
    environment:
      - DOMAIN=${DOMAIN} # ğŸŒŸ ë„ë©”ì¸ í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ğŸŒŸ
    depends_on:
      - open-webui # open-webui ì„œë¹„ìŠ¤ê°€ ì‹œì‘ëœ í›„ nginxê°€ ì‹œì‘ë©ë‹ˆë‹¤.
      - ollama # ollama ì„œë¹„ìŠ¤ê°€ ì‹œì‘ëœ í›„ nginxê°€ ì‹œì‘ë©ë‹ˆë‹¤.
    restart: unless-stopped # ì»¨í…Œì´ë„ˆê°€ ì¤‘ì§€ëœ ê²½ìš° ìë™ ì¬ì‹œì‘í•©ë‹ˆë‹¤.

  ollama:
    volumes:
      - ollama:/root/.ollama
    container_name: ollama
    pull_policy: always
    tty: true
    restart: unless-stopped
    image: ollama/ollama:${OLLAMA_DOCKER_TAG-latest} # OLLAMA_DOCKER_TAGë¥¼ ì‚¬ìš©í•´ ë²„ì „ì„ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

  open-webui:
    build:
      context: .
      args:
        OLLAMA_BASE_URL: '/ollama'
      dockerfile: Dockerfile
    image: ghcr.io/open-webui/open-webui:${WEBUI_DOCKER_TAG-main}
    container_name: open-webui
    volumes:
      - open-webui:/app/backend/data
    depends_on:
      - ollama # ollama ì„œë¹„ìŠ¤ê°€ ë¨¼ì € ì‹œì‘ëœ í›„ open-webuiê°€ ì‹œì‘ë©ë‹ˆë‹¤.
    ports:
      - ${OPEN_WEBUI_PORT-3000}:8080 # Open WebUIë¥¼ ì‚¬ìš©í•  í¬íŠ¸ë¥¼ ì„¤ì •í•©ë‹ˆë‹¤. ê¸°ë³¸ì ìœ¼ë¡œ 3000ë²ˆ í¬íŠ¸ë¡œ ì—´ë¦½ë‹ˆë‹¤.
    environment:
      - 'OLLAMA_BASE_URL=http://ollama:11434'
      - 'WEBUI_SECRET_KEY=' # WebUI ë³´ì•ˆ í‚¤ë¥¼ ì„¤ì •í•˜ëŠ” ê³³ì…ë‹ˆë‹¤. í•„ìˆ˜ëŠ” ì•„ë‹ˆì§€ë§Œ ë³´ì•ˆì„ ìœ„í•´ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    extra_hosts:
      - host.docker.internal:host-gateway # ë„ì»¤ ë‚´ë¶€ì—ì„œ í˜¸ìŠ¤íŠ¸ì— ì ‘ê·¼í•  ìˆ˜ ìˆë„ë¡ ì„¤ì •í•©ë‹ˆë‹¤.
    restart: unless-stopped # ì¤‘ì§€ëœ ê²½ìš° ì»¨í…Œì´ë„ˆê°€ ìë™ ì¬ì‹œì‘ë©ë‹ˆë‹¤.

volumes:
  ollama: {}
  open-webui: {}
